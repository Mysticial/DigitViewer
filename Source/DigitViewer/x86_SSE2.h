/* x86_SSE2.h
 * 
 * Author           : Alexander J. Yee
 * Date Created     : 09/03/2014
 * Last Modified    : 09/03/2014
 * 
 */

#pragma once
#ifndef ymp_x86_SSE2_H
#define ymp_x86_SSE2_H
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
//  Dependencies
#include <emmintrin.h>
#ifdef _WIN32
// Visual Studio puts _mm_set1_epi64x() in <intrin.h> instead of <emmintrin.h>.
#include <intrin.h>
#endif
#include "PublicLibs/CompilerSettings.h"
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
#if !(defined _WIN64) && !(defined __x86_64__)
#include <stdint.h>
//YM_FORCE_INLINE static __m128i _mm_set1_epi64x(int64_t x){
//    __m128i a = _mm_set1_epi32((int32_t)x);
//    __m128i b = _mm_set1_epi32((int32_t)(x >> 32));
//    return _mm_unpacklo_epi32(a, b);
//}
YM_FORCE_INLINE static int64_t _mm_cvtsi128_si64(__m128i x){
    return (uint32_t)_mm_cvtsi128_si32(x) | (int64_t)_mm_cvtsi128_si32(_mm_shuffle_epi32(x, 177)) << 32;
}
#endif
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
#endif
